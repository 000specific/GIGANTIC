// AI: Claude Code | Opus 4.6 | 2026 February 28 | Purpose: Nextflow configuration for OrthoHMM orthogroup pipeline
// Human: Eric Edsinger

// OrthoHMM Pipeline Configuration
// Runs OrthoHMM orthogroup detection with validation, statistics, and QC

params {
    // Input: proteomes directory from genomesDB
    proteomes_dir = '../../genomesDB/STEP_2-standardize_and_evaluate/output_to_input/gigantic_proteomes'

    // Pipeline output
    output_dir = 'OUTPUT_pipeline'

    // OrthoHMM parameters
    cpus = 8
    evalue = '0.0001'
    single_copy_threshold = '0.5'

    // Conda environment
    conda_environment = 'ai_gigantic_orthogroups'
}

process {
    errorStrategy = { task.attempt <= 2 ? 'retry' : 'terminate' }
    maxRetries = 2
    maxErrors = 0

    withName: 'validate_proteomes' {
        cpus = 1
        memory = '4 GB'
        time = '30m'
    }

    withName: 'convert_headers' {
        cpus = 1
        memory = '8 GB'
        time = '1h'
    }

    withName: 'run_orthohmm' {
        cpus = params.cpus
        memory = '64 GB'
        time = '48h'
    }

    withName: 'restore_identifiers' {
        cpus = 1
        memory = '8 GB'
        time = '1h'
    }

    withName: 'generate_summary_statistics' {
        cpus = 1
        memory = '4 GB'
        time = '30m'
    }

    withName: 'qc_analysis_per_species' {
        cpus = 1
        memory = '4 GB'
        time = '30m'
    }

}

timeline {
    enabled = true
    file = "${params.output_dir}/pipeline_timeline.html"
}

report {
    enabled = true
    file = "${params.output_dir}/pipeline_report.html"
}
