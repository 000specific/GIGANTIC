/*
 * GIGANTIC Orthogroups OrthoHMM - NextFlow Configuration
 * AI: Claude Code | Opus 4.5 | 2026 February 27
 * Human: Eric Edsinger
 *
 * Purpose: Load user configuration from YAML and set process defaults
 */

// ============================================================================
// LOAD YAML CONFIGURATION
// ============================================================================

import org.yaml.snakeyaml.Yaml

def loadConfig() {
    def configFile = new File("${projectDir}/../orthohmm_config.yaml")
    if (configFile.exists()) {
        def yaml = new Yaml()
        return yaml.load(configFile.text)
    }
    return [:]
}

def userConfig = loadConfig()

// ============================================================================
// PARAMETERS FROM YAML
// ============================================================================

params {
    // Input paths
    // GIGANTIC RULE: Inter-subproject inputs from output_to_input/, NEVER from X-output/
    input_proteomes = userConfig?.inputs?.proteomes ?: "../../../genomesDB/output_to_input/speciesN_gigantic_T1_proteomes"

    // Output settings
    output_dir = userConfig?.output?.base_dir ?: "OUTPUT_pipeline"

    // OrthoHMM settings
    orthohmm_cpus = userConfig?.orthohmm?.cpus ?: 100
    orthohmm_evalue = userConfig?.orthohmm?.evalue ?: "0.0001"
    orthohmm_single_copy_threshold = userConfig?.orthohmm?.single_copy_threshold ?: "0.5"
}

// ============================================================================
// EXECUTOR CONFIGURATION
// ============================================================================

executor {
    name = 'local'
    cpus = 100
    memory = '700 GB'
}

// ============================================================================
// PROCESS DEFAULTS
// ============================================================================

process {
    executor = 'local'

    // Fail-fast error handling (GIGANTIC standard for research pipelines)
    errorStrategy = 'terminate'
    maxRetries = 0
    maxErrors = 0

    // Default resources
    cpus = 4
    memory = '16 GB'
    time = '4h'

    withLabel: 'local' {
        executor = 'local'
        cpus = 4
        memory = '16 GB'
        time = '2h'
    }

    withLabel: 'heavy' {
        executor = 'local'
        cpus = 100
        memory = '500 GB'
        time = '200h'
    }
}

// ============================================================================
// MANIFEST
// ============================================================================

manifest {
    name = 'GIGANTIC-Orthogroups-OrthoHMM'
    author = 'Eric Edsinger (with Claude Code AI)'
    description = 'OrthoHMM clustering workflow for ortholog group identification'
    version = '1.0.0'
    nextflowVersion = '>=21.04.0'
}

// ============================================================================
// REPORTS
// ============================================================================

report {
    enabled = false
}

timeline {
    enabled = false
}

dag {
    enabled = false
}
