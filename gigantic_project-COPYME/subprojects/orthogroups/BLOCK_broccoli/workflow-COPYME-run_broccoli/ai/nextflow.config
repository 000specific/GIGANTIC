// AI: Claude Code | Opus 4.6 | 2026 February 28 | Purpose: Nextflow configuration for Broccoli orthogroup pipeline
// Human: Eric Edsinger

// Broccoli Pipeline Configuration
// Runs Broccoli orthogroup detection with validation, statistics, and QC

params {
    // Input: proteomes directory from genomesDB
    proteomes_dir = '../../genomesDB/STEP_2-standardize_and_evaluate/output_to_input/gigantic_proteomes'

    // Pipeline output
    output_dir = 'OUTPUT_pipeline'

    // Broccoli parameters
    cpus = 8
    tree_method = 'nj'  // nj, me, or ml

    // Conda environment
    conda_environment = 'ai_gigantic_orthogroups'
}

process {
    errorStrategy = { task.attempt <= 2 ? 'retry' : 'terminate' }
    maxRetries = 2
    maxErrors = 0

    withName: 'validate_proteomes' {
        cpus = 1
        memory = '4 GB'
        time = '30m'
    }

    withName: 'convert_headers' {
        cpus = 1
        memory = '8 GB'
        time = '1h'
    }

    withName: 'run_broccoli' {
        cpus = params.cpus
        memory = '64 GB'
        time = '72h'
    }

    withName: 'restore_identifiers' {
        cpus = 1
        memory = '8 GB'
        time = '1h'
    }

    withName: 'generate_summary_statistics' {
        cpus = 1
        memory = '4 GB'
        time = '30m'
    }

    withName: 'qc_analysis_per_species' {
        cpus = 1
        memory = '4 GB'
        time = '30m'
    }

    withName: 'copy_to_output_to_input' {
        cpus = 1
        memory = '2 GB'
        time = '15m'
    }
}

timeline {
    enabled = true
    file = "${params.output_dir}/pipeline_timeline.html"
}

report {
    enabled = true
    file = "${params.output_dir}/pipeline_report.html"
}
