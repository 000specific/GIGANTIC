// AI: Claude Code | Opus 4.6 | 2026 February 27 | Purpose: NextFlow configuration for STEP_1 RGS validation
// Human: Eric Edsinger

// ============================================================================
// STEP_1 RGS Validation - NextFlow Configuration
// ============================================================================

// Load user config from YAML
import org.yaml.snakeyaml.Yaml

def yaml = new Yaml()
def config_file = file( "${projectDir}/../rgs_config.yaml" )
def user_config = config_file.exists() ? yaml.load( config_file.text ) : [:]

// Execution settings
process {
    executor = 'local'
    errorStrategy = 'terminate'
    maxRetries = 0
    maxErrors = 0

    withLabel: 'local' {
        cpus = 1
        memory = '4 GB'
        time = '1h'
    }
}

// Reporting
timeline {
    enabled = true
    file = "${projectDir}/../${user_config?.output?.base_dir ?: 'OUTPUT_pipeline'}/rgs_validation_timeline.html"
    overwrite = true
}

report {
    enabled = true
    file = "${projectDir}/../${user_config?.output?.base_dir ?: 'OUTPUT_pipeline'}/rgs_validation_report.html"
    overwrite = true
}

trace {
    enabled = true
    file = "${projectDir}/../${user_config?.output?.base_dir ?: 'OUTPUT_pipeline'}/rgs_validation_trace.txt"
    overwrite = true
}

dag {
    enabled = true
    file = "${projectDir}/../${user_config?.output?.base_dir ?: 'OUTPUT_pipeline'}/rgs_validation_dag.svg"
    overwrite = true
}

// Manifest
manifest {
    name = 'GIGANTIC STEP_1 RGS Validation'
    author = 'Eric Edsinger (with AI: Claude Code | Opus 4.6)'
    description = 'Validate and prepare Reference Gene Set files'
    mainScript = 'main.nf'
    version = '1.0.0'
    nextflowVersion = '>=21.04.0'
}
